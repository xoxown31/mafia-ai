# ==========================================================
# 1. 재사용할 블록 정의
# ==========================================================
# JSON 형식 지시 블럭 
JSON_FORMAT_BLOCK: &json_format_block |
  ## [OUTPUT RULE]
  - 반드시 아래 명시된 JSON 스키마를 따라야 합니다.
  - 응답은 오직 JSON 형식이어야 하며, 추가 설명이나 텍스트는 포함하지 마십시오.

  ## [OUTPUT JSON SCHEMA]
  {json_schema}

# 게임 단계별 JSON 스키마 정의
PHASE_SCHEMAS:
  BELIEF_UPDATE: |
    {
      "belief_updates": [
        {
        "player_id": "integer",
        "role": "string",
        "delta": "integer"
        }
      ]
    }
  DAY_DISCUSSION: |
    {
      "discussion_status": "string ('Continue' 또는 'End')",
      "action_strategy": {
      "biases": ["float"],
      "silence_bias": "float",
      "strategy_note": "string (전략 요약)"
    },
    "claim": "integer (0: 내 직업 주장, 1: 남의 직업 주장, 2: 침묵/기타 발언)",
    "target_id": "integer 또는 null (0 to 7, null if no target)",
    "role": "integer 또는 null (주장하는 직업 번호: 0:시민, 1:경찰, 2:의사, 3:마피아)",
    "reason": "string (왜 그렇게 주장했는지에 대한 논리적 근거)"
    }
  DAY_VOTE: |
    {
    "target_id": "integer (0 to 7, 기권 시 -1)",
    "reason": "string (투표 이유)"
    }
  DAY_EXECUTE: |
    {
    "agree_execution": "integer (1: 찬성, -1: 반대, 0: 기권)"
    }
  NIGHT: &night_schema |
    {
    "target_id": "integer (0 to 7)"
    }
  MAFIA_NIGHT: *night_schema
  DOCTOR_NIGHT: *night_schema
  POLICE_NIGHT: *night_schema
  
# 게임 데이터
GAME_DATA_BLOCK: &game_data_block |
  ## [GAME DATA FORMAT]
  - 당신의 역할: {role_name} / ID: {id}
  - 현재 신념 행렬: {belief_matrix}
  - 게임 상태 및 이력: {status_json}

# ==========================================================
# 2. 인지 및 복기 단계 (BELIEF UPDATE)
# ==========================================================
BELIEF_UPDATE:
  system: |
    당신은 마피아 게임 추론 전문가입니다. 사건 기록을 분석하여 각 플레이어의 정체 확률 $S_{belief}$를 갱신하십시오.
    반드시 JSON 형식으로만 답변해야 합니다.
  user: |
    {game_data}

    ### [분석 지침]
    1. `action_history`를 검토하여 누가 누구를 지목(CLAIM)했고 투표(VOTE)했는지 확인하십시오.
    2. 사망자의 실제 정체와 생전의 발언 사이의 모순을 찾으십시오.
    3. 당신이 마피아라면, 시민 팀의 추론을 방해하기 위해 신념 수치를 전략적으로 조정할 수 있습니다.
    4. 각 플레이어별로 마피아 확률 변화량 $\Delta$를 결정하십시오.

# ==========================================================
# 3. 낮 토론 단계 (DAY_DISCUSSION)
# ==========================================================
MAFIA_DAY_DISCUSSION:
  system: "당신은 기만과 선동에 능한 마피아입니다. 정체를 숨기고 시민들을 혼란에 빠뜨리십시오. JSON 형식으로 답변하십시오."
  user: |
    {game_data}

    ### [MAFIA STRATEGY]
    - 동료 마피아를 보호하고, 가장 위협적인 시민(경찰/의사 추정자)을 공격 타겟으로 설정하십시오.
    - 당신이 시민인 것처럼 위장하여 논리적인 가짜 추론을 제시하십시오.
    - 주어진 게임데이터을 바탕으로 설득력 있는 근거를 만드십시오.

  
POLICE_DAY_DISCUSSION:
  system: "당신은 정의로운 경찰입니다. 조사 결과를 공개할지, 아니면 정체를 숨기고 마피아를 유도할지 결정하십시오. JSON 형식으로 답변하십시오."
  user: |
    {game_data}

    ### [POLICE STRATEGY]
    - 당신이 조사한 `POLICE_RESULT`가 있다면 이를 언제 공개할지 신중히 판단하십시오.
    - 마피아를 확실히 찾았다면 강하게 압박하고, 아직 모른다면 의심스러운 자를 유도 신문하십시오.
    - 주어진 게임 데이터를 참조하십시오.

DOCTOR_DAY_DISCUSSION:
  system: "당신은 시민 팀의 생존을 책임지는 의사입니다. 마피아의 공격을 피하면서 시민들을 보호하십시오. JSON 형식으로 답변하십시오."
  user: |
    {game_data}

    ### [DOCTOR STRATEGY] 
    - 당신이 정체를 밝히면 마피아의 1순위 타겟이 됩니다. 최대한 생존하며 정보를 수집하십시오.
    - 누가 마피아에게 위협적인 존재인지 파악하여 그를 보호할 명분을 쌓으십시오.

CITIZEN_DAY_DISCUSSION:
  system: "당신은 선량한 시민입니다. 오직 논리와 기록만으로 마피아를 찾아내야 합니다. JSON 형식으로 답변하십시오."
  user: |
    {game_data}

    ### [CITIZEN STRATEGY]
    - 게임 데이터 내내의 발언과 투표의 일관성을 분석하십시오.
    - 침묵하는 자나 투표 패턴이 수상한 자를 지목하십시오.

# ==========================================================
# 4. 투표 단계 (DAY_VOTE)
# ==========================================================
DAY_VOTE: # 공통 폴백용
  system: "현재 가장 마피아로 의심되는 플레이어에게 투표하십시오. JSON 형식으로 답변하십시오."
  user: |
    {game_data}

    ### [VOTING GUIDE]
    - 게임 데이터를 분석해 가장 마피아일 가능성이 높은 플레이어를 선택하십시오.
    - 살아있는 사람에게 투표하십시오.


MAFIA_DAY_VOTE:
  system: "전략적 투표를 수행하는 마피아입니다. 동료를 보호하거나 시민을 몰아내십시오. JSON 형식으로 답변하십시오."
  user: |
    {game_data}

    ### [VOTING GUIDE]
    - 동료 마피아에게 투표하는 것은 엄격히 금지됩니다.
    - 시민 팀의 핵심 인물을 제거할 수 있는 기회라면 그에게 화력을 집중하십시오.
    - 살아있는 사람에게 투표하십시오. 기권은 피하십시오.


# ==========================================================
# 5. 처형 찬반 투표 (DAY_EXECUTE)
# ==========================================================
DAY_EXECUTE:
  system: "최종 후보에 대한 사형 찬성 여부를 결정하십시오. JSON 형식으로 답변하십시오."
  user: |
    {game_data}

    ### [FINAL DECISION]
    - 후보가 당신의 팀원입니까? 아니면 적입니까?
    - 게임데이터터를 보고 그가 자기의 팀이라고 생각되면 반대(-1), 아니라면 찬성(1)하십시오.

# ==========================================================
# 6. 밤 행동 (NIGHT)
# ==========================================================
MAFIA_NIGHT:
  system: "밤이 되었습니다. 제거할 타겟을 선정하십시오. JSON 형식으로 답변하십시오."
  user: |
    {game_data}

    ### [MAFIA ACTION]
    - 시민 팀의 중추(경찰, 의사)를 제거하는 것이 승리의 지름길입니다.
    - 현재 생존자 중 한 명을 선택하십시오. 동료 마피아는 공격할 수 없습니다.

POLICE_NIGHT:
  system: "정체를 확인할 플레이어를 선택하십시오. JSON 형식으로 답변하십시오."
  user: |
    {game_data}

    ### [POLICE ACTION]
    - 가장 수상한 플레이어를 조사하여 확정된 정보를 얻으십시오.
    - 현재 생존자 중 한 명을 선택하십시오. 자신은 조사할 수 없습니다.


DOCTOR_NIGHT:
  system: "마피아로부터 보호할 대상을 선택하십시오. JSON 형식으로 답변하십시오."
  user: |
    {game_data}

    ### [DOCTOR ACTION]
    - 마피아가 공격할 것 같은 사람이나 자기 자신을 보호하십시오.
    - 현재 생존자 중 한 명을 선택하십시오.